<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>app.rb</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>app.rb</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-&lt;em&gt;Week_04:_We_return_with_more_Sinatra._Introducing_templates,_stylesheets_and_javascripts.&lt;/em&gt;'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-&lt;em&gt;Week_04:_We_return_with_more_Sinatra._Introducing_templates,_stylesheets_and_javascripts.&lt;/em&gt;">&#182;</a>
        </div>
        <h4><em>Week 04: We return with more Sinatra. Introducing templates, stylesheets and javascripts.</em></h4>

<h4><em>Part of <a href="http://itpwebdev.github.com">ITP Web Dev Workshop</a></em></h4>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-2">&#182;</a>
        </div>
        <p>Last time we introduce you to <a href="http://www.sinatrarb.com">Sinatra</a>,
if you don&rsquo;t remember, head on over to
<a href="http://itpwebdev.github.com/03-Intro-To-Ruby---HTTP/">Lesson 3</a></p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-3">&#182;</a>
        </div>
        <p>We&rsquo;re on our way to a <a href="http://en.wikipedia.org/wiki/Model–view–controller">Model View Controller</a>
architecture. Last week we covered the <em>Controller</em> last time but
we didn&rsquo;t really mention it. A <em>Controller</em> for our purposes is a
url, and we write this with Sinatra with</p>

<pre><code>get &lsquo;/&rsquo; do
  # CONTROLLER CODE
end
</code></pre>

<p>This week we&rsquo;re getting in to the other two parts, Views and Models.
Views are what is shown. Controllers call on Views. A webpage is a
view and the url is a representation of the controller. We&rsquo;ll get in
to this more further down.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-4'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-4">&#182;</a>
        </div>
        <p>First we need to set up the app, just like last time we tell Ruby to 
look at our gems and then get the Sinatra gem.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;sinatra&#39;</span></pre></div>
      </td>
    </tr>
    <tr id='section-5'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-5">&#182;</a>
        </div>
        <p>And our root controller <code>&lsquo;/&rsquo;</code>. This controller takes the user input
and deciphers it to respond with a view.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">get</span> <span class="s1">&#39;/&#39;</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-6'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-6">&#182;</a>
        </div>
        <p>Let&rsquo;s show the user the current time, for this we&rsquo;ll use an instance
variable. Instance variables are super variables. They are local to
Sinatra, not to a specific file so we can use them between the controller
and the view.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span></pre></div>
      </td>
    </tr>
    <tr id='section-7'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-7">&#182;</a>
        </div>
        <p>Also, let&rsquo;s give our site a Title</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;ITP Web Dev Blog&quot;</span>
  </pre></div>
      </td>
    </tr>
    <tr id='section-8'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-8">&#182;</a>
        </div>
        <p>Here we call our template with the method <code>erb</code>. Erb is a templating
system for Ruby. Templates allow us to have only a few pages and fill
them in with dynamic data.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  </pre></div>
      </td>
    </tr>
    <tr id='section-9'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-9">&#182;</a>
        </div>
        <p>So <code>erb</code> is the method and as an argument I&rsquo;m passing in <code>:main</code> which
is understood to be a file named <code>main.erb</code>. (More on this later.)</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">erb</span> <span class="ss">:main</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-10'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-10">&#182;</a>
        </div>
        <p>Now if we start up the application (in Terminal <code>cd</code> to the appropriate
directory) with</p>

<pre><code>$ ruby app.rb
</code></pre>

<p>And point our browser to <code>http://localhost:4567/</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-11'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-11">&#182;</a>
        </div>
        <p>What the blazes! It looks like a webpage. What&rsquo;s going on?
If you look at the <code>views/</code> folder you&rsquo;ll see 2 files (you might see more
but focus on these 2): <code>layout.erb</code> and <code>main.erb</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-12'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-12">&#182;</a>
        </div>
        <p>Open up <code>layout.erb</code>, if you don&rsquo;t want to do that, here it is:</p>

<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
   &lt;head&gt;
     &lt;title&gt;&lt;%= @title %&gt;&lt;/title&gt;
     &lt;link rel=&ldquo;stylesheet&rdquo; href=&ldquo;style.css&rdquo;/&gt;
   &lt;/head&gt;
   &lt;body&gt;
     &lt;div id=&ldquo;wrapper&rdquo;&gt;
       &lt;h1&gt;&lt;%= @title %&gt;&lt;/h1&gt;
       &lt;%= yield %&gt;
     &lt;/div&gt;
   &lt;/body&gt;
 &lt;/html&gt;
</code></pre>

<p>It looks mostly like HTML except for the <code>&lt;%= %&gt;</code> bits right?
Good, because it is just like HTML except for those bits. Inside of 
these tags goes Ruby code. There are two varieties:</p>

<p><strong>Inline Code</strong> Ruby inside of these tags is processed but does not
render to the page</p>

<pre><code>&lt;% %&gt;
</code></pre>

<p><strong>Rendered Code</strong> The results of the Ruby code inside these tags is
rendered to the document</p>

<pre><code>&lt;%= %&gt;
</code></pre>

<p>So with this knowledge we see that <code>&lt;%= @title %&gt;</code> is going to print
out the value of the <code>@title</code> variable in the document.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-13'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-13">&#182;</a>
        </div>
        <p>There&rsquo;s one other bit, <code>&lt;%= yield %&gt;</code>. This is a method that tells Erb
to put the contents of whatever erb file we asked for in place of <code>yield</code>.
So right now that means the contents of <code>main.erb</code> is getting put in place
of <code>yield</code> since we asked for <code>erb :main</code>.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-14'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-14">&#182;</a>
        </div>
        <p>Something I didn&rsquo;t explain, this file <code>layout.erb</code> is pulled up by Erb
every time we call <code>erb</code>. So if you open up <code>main.erb</code> you&rsquo;ll notice there
are none of the HTML <code>head</code> elements, just the content. Awesome.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-15'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-15">&#182;</a>
        </div>
        <p>Look at <code>main.erb</code>, it&rsquo;s three lines long, one of them a long line. What I&rsquo;m
doing there is taking the <code>@time</code> variable and calling a few methods on
it. Refer to the <a href="http://www.ruby-doc.org/core/Time.html">Ruby-doc for Time</a> for
the methods I called, and play around with your own to reformat the date.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-16'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-16">&#182;</a>
        </div>
        <p>Alright, back to our application. It just shows the time, let&rsquo;s make it in 
to a simple blog because everyone loves blogging.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-17'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-17">&#182;</a>
        </div>
        <p>We&rsquo;ll make a controller called <strong>article</strong> for our blog article</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">get</span> <span class="s1">&#39;/article&#39;</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-18'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-18">&#182;</a>
        </div>
        <p>Using Ruby&rsquo;s Hash class to encapsulate the Title and Content in
one instance variable.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@article</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;My first blog post&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Hello nerds, I&#39;m starting a blog.&quot;</span><span class="p">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-19'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-19">&#182;</a>
        </div>
        <p>Render the newly created <code>article.erb</code> page.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">erb</span> <span class="ss">:article</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-20'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-20">&#182;</a>
        </div>
        <p>How would I make a second article?
Re-do everything from <code>/article</code>, this time at <code>/article/two</code></p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">get</span> <span class="s1">&#39;/article/two&#39;</span> <span class="k">do</span>
  <span class="vi">@article</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Really getting going with this whole blogging thing.&quot;</span><span class="p">,</span>
    <span class="s2">&quot;content&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Look at me right now, totally blogging up a storm. Don&#39;t you dare try to stop me.&quot;</span><span class="p">}</span>

  <span class="n">erb</span> <span class="ss">:article</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-21'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-21">&#182;</a>
        </div>
        <p>This is going to get ugly, but the way to fix this is with databases and
we aren&rsquo;t there yet. First we need an interface to add new articles.
The start of the interface is a controller to get there</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">get</span> <span class="s1">&#39;/article/new&#39;</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-22'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-22">&#182;</a>
        </div>
        <p>Then we need a view with a form</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">erb</span> <span class="ss">:new_article</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-23'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-23">&#182;</a>
        </div>
        <p>Let&rsquo;s look at the file <code>new_article.erb</code> in depth.</p>

<pre><code>  &lt;article&gt;
  &lt;h1&gt;Write a new Article&lt;/h1&gt;

  &lt;form action=&ldquo;/article/create&rdquo; method=&ldquo;post&rdquo;&gt;
    &lt;div&gt;
      &lt;label for=&ldquo;title&rdquo;&gt;Title:&lt;/label&gt;
      &lt;input name=&ldquo;title&rdquo; type=&ldquo;text&rdquo;/&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label for=&ldquo;content&rdquo;&gt;Content:&lt;/label&gt;
      &lt;textarea name=&ldquo;content&rdquo;&gt;&lt;/textarea&gt;
    &lt;/div&gt;
    &lt;input type=&ldquo;submit&rdquo;/&gt;
  &lt;/form&gt;

  &lt;p&gt;&lt;a href=&ldquo;/&rdquo;&gt;Home&lt;/a&gt;&lt;/p&gt;
  &lt;/article&gt;
</code></pre>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-24'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-24">&#182;</a>
        </div>
        <p>Actually, we can skip right
to the <code>form</code> tag. It&rsquo;s got two attributes:</p>

<ul>
<li><strong>action</strong> is the url which will be requested when the form is submitted</li>
<li><strong>method</strong> here we choose the verb we want to make the request with.
It can be <code>get</code>, <code>post</code>, <code>put</code> or <code>delete</code>. We are using <code>post</code> because
we are creating something.</li>
</ul>

<p>Then we have <code>label</code> tags which when combined with the <code>for=</code> attribute are
rather self explanatory. <code>input</code> and <code>textarea</code> are two different form fields
with their own syntaxes, <code>textarea</code> requires a close tag but <code>input</code> does not.
They both need a <code>name=</code> attribute, the value of this attribute will tell
the server what the name of the inputs is.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-25'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-25">&#182;</a>
        </div>
        <p>When you hit submit, you&rsquo;ll get sent to <code>/article/create</code> and it will be a <em>POST</em>
request. Let&rsquo;s make that controller.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="n">post</span> <span class="s1">&#39;/article/create&#39;</span> <span class="k">do</span></pre></div>
      </td>
    </tr>
    <tr id='section-26'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-26">&#182;</a>
        </div>
        <p>The parameters sent with this HTTP request are saved by Sinatra in the <code>params</code> hash.
A handy trick to see what are in your params is to raise an error to see the params dump.</p>

<p>raise params.inspect</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="vi">@article</span> <span class="o">=</span> <span class="n">params</span></pre></div>
      </td>
    </tr>
    <tr id='section-27'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-27">&#182;</a>
        </div>
        <p>Ahh, the beauty of templates, reusing the same erb file.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="n">erb</span> <span class="ss">:article</span>
<span class="k">end</span></pre></div>
      </td>
    </tr>
    <tr id='section-28'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-28">&#182;</a>
        </div>
        <p>You&rsquo;ll notice that this data does not persist. If you try to go back to <code>/article/create</code>
nothing is there. It probably will give you an error. Since this was
a <em>POST</em> request and not a <em>GET</em>. We need databases!</p>
      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
    <tr id='section-29'>
      <td class=docs>
        <div class="pilwrap">
          <a class="pilcrow" href="#section-29">&#182;</a>
        </div>
        <p>Stay tuned.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre></pre></div>
      </td>
    </tr>
  </table>
</div>
</body>
